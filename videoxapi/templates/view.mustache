{{!
    This file is part of Moodle - http://moodle.org/

    Moodle is free software: you can redistribute it and/or modify
    it under the terms of the GNU General Public License as published by
    the Free Software Foundation, either version 3 of the License, or
    (at your option) any later version.

    Moodle is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU General Public License for more details.

    You should have received a copy of the GNU General Public License
    along with Moodle.  If not, see <http://www.gnu.org/licenses/>.
}}
{{!
    @template videoxapi/view

    Main view template for videoxapi activity

    Context variables required for this template:
    * videoxapi - The videoxapi instance
    * cm - Course module
    * course - Course object
    * playerid - Video player element ID
    * hasvideo - Whether video is configured
    * videourl - Video URL (generated from source or file)
    * videosource - Video source type ('url' or 'file')
    * cancreatebookmarks - User can create bookmarks
    * canviewallbookmarks - User can view all bookmarks
    * canviewreports - User can view reports
    * caneditinstance - User can edit the instance

    Example context (json):
    {
        "videoxapi": {
            "id": 1,
            "name": "Sample Video",
            "video_url": "https://example.com/video.mp4",
            "video_width": 640,
            "video_height": 360,
            "enable_bookmarks": 1
        },
        "playerid": "videoxapi-player-1",
        "cancreatebookmarks": true,
        "canviewallbookmarks": false,
        "canviewreports": false
    }
}}

<div class="videoxapi-container">
    {{#hasvideo}}
    <div class="videoxapi-player-wrapper">
        <video
            id="{{playerid}}"
            class="video-js vjs-default-skin videoxapi-player"
            controls
            preload="metadata"
            {{#videoxapi.video_width}}width="{{videoxapi.video_width}}"{{/videoxapi.video_width}}
            {{#videoxapi.video_height}}height="{{videoxapi.video_height}}"{{/videoxapi.video_height}}
            {{#videoxapi.responsive_sizing}}data-responsive="true"{{/videoxapi.responsive_sizing}}
            data-setup='{"fluid": {{#videoxapi.responsive_sizing}}true{{/videoxapi.responsive_sizing}}{{^videoxapi.responsive_sizing}}false{{/videoxapi.responsive_sizing}}}'
            crossorigin="anonymous"
        >
            <!-- Video source will be set by JavaScript to ensure proper MIME type -->
            <p class="vjs-no-js">
                JavaScript devre dışı veya desteklenmiyor. Video izlemek için lütfen JavaScript'i etkinleştirin.
                <br>
                <a href="https://videojs.com/html5-video-support/" target="_blank">
                    Tarayıcınızı güncelleyin
                </a>
            </p>
        </video>
        
        <!-- Fallback for direct video access -->
        <noscript>
            <div class="alert alert-warning">
                <strong>JavaScript Gerekli:</strong> Bu video oynatıcı JavaScript gerektirir. 
                <a href="{{videourl}}" target="_blank">Videoyu doğrudan açmak için tıklayın</a>.
            </div>
        </noscript>
    </div>
    {{/hasvideo}}

    {{#videoxapi.enable_bookmarks}}
    <div class="videoxapi-bookmarks-section">
        <h3>{{#str}}bookmarks, videoxapi{{/str}}</h3>
        <div id="videoxapi-bookmarks-{{videoxapi.id}}" class="videoxapi-bookmarks-list">
            <!-- Bookmarks will be loaded here via JavaScript -->
        </div>
    </div>
    {{/videoxapi.enable_bookmarks}}

    {{#canviewreports}}
    <div class="videoxapi-reports-section mt-4">
        <h3>{{#str}}reports, videoxapi{{/str}}</h3>
        <a href="{{config.wwwroot}}/mod/videoxapi/report.php?id={{cm.id}}" class="btn btn-secondary">
            <i class="fa fa-chart-bar" aria-hidden="true"></i>
            {{#str}}viewreports, videoxapi{{/str}}
        </a>
    </div>
    {{/canviewreports}}
</div>